// Stepwise story flow for the puzzle site

const STEPS = [
  {
    key: "step1",
    answer: "ã™ãŸãƒ¼ã¨",
    storyTitle: "ãƒ—ãƒ­ãƒ­ãƒ¼ã‚° / STORY1",
    story: [
      "ã‚ãªãŸã¯ã€è¬Žåˆ¶ä½œä¼šç¤¾ã®ãƒãƒ¼ãƒ•ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼ã€‚ç¤¾å†…ã§ä½œã‚‰ã‚ŒãŸã•ã¾ã–ã¾ãªè¬Žè§£ãã‚’ãƒ†ã‚¹ãƒˆãƒ—ãƒ¬ã‚¤ã€è¬Žè§£ãã«å•é¡ŒãŒãªã„ã‹ãƒã‚§ãƒƒã‚¯ã‚’ã—ã¦ã€è²©å£²ã®å¯å¦ã‚’æ±ºã‚ã‚‹ã®ãŒä¸»ãªä»•äº‹ã ã€‚",
      "ä»Šæ—¥ãƒ†ã‚¹ãƒˆãƒ—ãƒ¬ã‚¤ã‚’ã™ã‚‹è¬Žè§£ãã¯ã€æŒã¡å¸°ã‚Šè¬Žè§£ãã€Žã‚¹ã‚¯ã‚¨ã‚¢ã€ã€‚å…¥ç¤¾æ•°å¹´ã®ç¤¾å“¡ãŒåˆ¶ä½œã—ãŸåŠ›ä½œã‚‰ã—ã„ã€‚",
      "ã‚ãªãŸã¯ã€ã©ã‚“ãªã‚‚ã®ãŒéŠã¹ã‚‹ã®ã‹ãƒ¯ã‚¯ãƒ¯ã‚¯ã—ãªãŒã‚‰ã€ä¼šè­°å®¤ã§å¾…ã£ã¦ã„ãŸã€‚",
      "ã“ã‚ŒãŒã€ãƒ‰ã‚¿ãƒã‚¿ã§ãƒˆãƒ©ãƒ–ãƒ«ç¶šããªãƒ†ã‚¹ãƒˆãƒ—ãƒ¬ã‚¤ã«ãªã‚‹ã¨ã¯çŸ¥ã‚‰ãšã«ãƒ»ãƒ»ãƒ»",
      "",
      "STORYï¼‘",
      "ã‚ãªãŸã€Œé›†åˆæ™‚é–“éŽãŽã¦ã‚‹ãªã€ã‚ã„ã¤é…åˆ»ã‹ï¼Ÿãƒ»ãƒ»ãƒ»ã‚ã‚Œã€ãƒãƒ£ãƒƒãƒˆãŒæ¥ã¦ã‚‹ã€",
      "ã€Žãƒãƒ¼ãƒ•ãŠç–²ã‚Œæ§˜ã§ã™ã€‚\nã€€ã™ã¿ã¾ã›ã‚“ã€ä»Šæ—¥ä½“èª¿ã‚’å´©ã—ã¦ã—ã¾ã£ã¦ãƒ†ã‚¹ãƒˆãƒ—ãƒ¬ã‚¤ã«ç«‹ã¡ä¼šãˆã¾ã›ã‚“ðŸ™‡â€â™€ï¸\nã€€ã‚­ãƒƒãƒˆã®æº–å‚™ã¯æ–°å…¥ç¤¾å“¡ã«ä»»ã›ãŸã®ã§ã€å½¼ã‹ã‚‰å—ã‘å–ã£ã¦ãã ã•ã„ï¼\nã€€ãƒ’ãƒ³ãƒˆã¯ãªã„ã§ã™ãŒã€ã‚²ãƒ¼ãƒ ã‚µã‚¤ãƒˆã¯ã§ãã¦ã„ã‚‹ã®ã§å•é¡ŒãªãéŠã¹ã¾ã™ï¼\nã€€ãã‚Œã§ã¯ã€æ„Ÿæƒ³ãŠå¾…ã¡ã—ã¦ã¾ã™ã€‚ã€",
      "ã‚ãªãŸã€Œåˆ¶ä½œè€…ãŒç«‹ã¡ä¼šã£ã¦ã“ãã®ãƒ†ã‚¹ãƒˆãƒ—ãƒ¬ã‚¤ãªã®ã«ã€ç¾å ´ã«ã„ãªã„ã®ã¯å‰ä»£æœªèžã ã‘ã©ã€ã¾ã‚ä»Šå›žã¯è²©å£²ã¾ã§æ™‚é–“ã‚‚ãªã„ã—ä»•æ–¹ãªã„ã‹ã€",
      "ã—ã°ã‚‰ãã™ã‚‹ã¨ã€ä¼šè­°å®¤ã®æ‰‰ãŒé–‹ã„ãŸã€‚",
      "æ–°å…¥ç¤¾å“¡ã€ŒãŠç–²ã‚Œæ§˜ã§ã™ï¼ã‚­ãƒƒãƒˆã‚’ãŠæŒã¡ã—ã¾ã—ãŸï¼ã€",
      "ã‚ã€ŒãŠã‰ã€ãŠç–²ã‚Œã€‚ã¡ã‚ƒã‚“ã¨æº–å‚™ã§ããŸã‹ï¼Ÿã€",
      "æ–°ã€Œã¯ã„ï¼å…ˆè¼©ã®æŒ‡ç¤ºé€šã‚Šã€è¬Žãƒ‡ãƒ¼ã‚¿ã‚’å°åˆ·ã—ã¦ç´™ã‚‚ï¼”ç­‰åˆ†ã«è£æ–­ã—ã¾ã—ãŸï¼ã€",
      "ã‚ã€Œã‚ªãƒƒã‚±ãƒ¼ã€ã˜ã‚ƒã‚æ—©é€ŸéŠã°ã›ã¦ã‚‚ã‚‰ã†ã‚ˆã€",
    ],
    instructionLabel: "1stã‚¹ãƒ†ãƒƒãƒ—",
    instructionLines: [
      "ï¼‘ã®å°ç­’ã®ä¸­ã«ã‚ã‚‹1stã‚¹ãƒ†ãƒƒãƒ—ã®ã‚­ãƒƒãƒˆã‚’å–ã‚Šå‡ºãã†ã€‚",
      "è¬Žã‚’è§£ãæ˜Žã‹ã—ã¦ã€webã‚µã‚¤ãƒˆã«å…¥åŠ›ã™ã‚‹1stã‚¹ãƒ†ãƒƒãƒ—ã®ç­”ãˆã‚’é€ä¿¡ã—ã‚ˆã†ã€‚",
      "ï¼œã€€ã²ã‚‰ãŒãªã§å…¥åŠ›ã€€ï¼ž",
    ],
    placeholder: "ã“ãŸãˆã‚’å…¥åŠ›",
  },
  {
    key: "step2",
    answer: "ã¨ã‚ŠãŒãƒ¼",
    storyTitle: "STORY2",
    story: [
      "ã‚ã€Œ1stã‚¹ãƒ†ãƒƒãƒ—ã¯ã“ã‚“ãªã‚‚ã‚“ã‹ã€‚ã‚ˆã—ã€æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã®ã‚­ãƒƒãƒˆã‚’ãã‚Œã€",
      "æ–°ã€Œã‚ã‹ã‚Šã¾ã—ãŸï¼æº–å‚™ã™ã‚‹ã®ã§ãŠå¾…ã¡ãã ã•ã„ï¼ã€",
      "ã‚ï¼ˆ1stã‚¹ãƒ†ãƒƒãƒ—ã‚’è§£ã„ã¦ã„ã‚‹é–“ã«æº–å‚™ã—ã¨ã‘ã‚ˆã€œã€‚ã¾ã‚æ–°å…¥ç¤¾å“¡ã ã—å¤šã‚ã«è¦‹ã‚‹ã‹ï¼‰",
      "æ–°ã€Œã‚ãããã‚ã‚ã‚ï¼ã€",
      "ã‚ã€Œï¼Ÿï¼ã ã€å¤§ä¸ˆå¤«ã‹ï¼Ÿã€",
      "æ–°ã€Œå¤§ä¸ˆå¤«ã§ã™ï¼ãƒãƒ¼ãƒ•ã¯ãã“ã«ã„ã¦ãã ã•ã„ï¼ã€",
      "æ•°åˆ†å¾Œã€æ–°å…¥ç¤¾å“¡ãŒæ¬¡ã®ã‚­ãƒƒãƒˆã‚’æŒã£ã¦ãã¾ã—ãŸã€‚",
      "æ–°ã€ŒãŠå¾…ã›ã—ã¾ã—ãŸï¼ã“ã¡ã‚‰ãŒæ¬¡ã®ã‚­ãƒƒãƒˆâ€¦â€¦ãªã‚“ã§ã™ãŒâ€¦â€¦ã€",
      "ã‚ã€Œã‚“ï¼Ÿã©ã†ã—ãŸï¼Ÿã€",
      "æ–°ã€Œå®Ÿã¯ã€ãƒ—ãƒªãƒ³ã‚¿ãƒ¼ã®é’è‰²ã®ã‚¤ãƒ³ã‚¯ãŒãªããªã£ã¦ã„ã‚‹ã®ã«æ°—ã¥ã‹ãšå°åˆ·ã—ã¦ã—ã¾ã£ãŸã‚“ã§ã™â€¦â€¦ã€‚ãƒãƒ¼ãƒ•ã«ã¯ç”³ã—è¨³ãªã„ã‚“ã§ã™ãŒã€é’è‰²ã®ã‚¤ãƒ³ã‚¯ãŒãªããªã£ã¦ã—ã¾ã£ãŸè¬ŽãŒå…ƒã¯ã©ã‚“ãªè¬Žã ã£ãŸã®ã‹ã‚’æƒ³åƒã—ã¦è§£ã„ã¦ãã‚Œã¾ã›ã‚“ã‹â€¦â€¦ï¼Ÿãƒãƒ¼ãƒ•ã®è¬Žè§£ãåŠ›ãªã‚‰ãã£ã¨å¤§ä¸ˆå¤«ã§ã™ï¼ã€",
      "ã‚ã€Œã¾ã€ã¾ãæ™‚é–“ã‚‚ãªã„ã—ã‚„ã‚‹ã—ã‹ãªã„ã‹â€¦â€¦ã€",
    ],
    instructionLabel: "2ndã‚¹ãƒ†ãƒƒãƒ—",
    instructionLines: [
      "ï¼’ã®å°ç­’ã®ä¸­ã«ã‚ã‚‹2ndã‚¹ãƒ†ãƒƒãƒ—ã®ã‚­ãƒƒãƒˆã‚’å–ã‚Šå‡ºãã†ã€‚",
      "è¬Žã‚’è§£ãæ˜Žã‹ã—ã¦ã€webã‚µã‚¤ãƒˆã«å…¥åŠ›ã™ã‚‹2ndã‚¹ãƒ†ãƒƒãƒ—ã®ç­”ãˆã‚’é€ä¿¡ã—ã‚ˆã†ã€‚",
      "ï¼œã€€ã²ã‚‰ãŒãªã§å…¥åŠ›ã€€ï¼ž",
    ],
    placeholder: "ã“ãŸãˆã‚’å…¥åŠ›",
  },
  {
    key: "step3",
    answer: "ã‹ã¿ã²ã¨ãˆ",
    storyTitle: "STORY3",
    story: [
      "ã‚ã€Œ2ndã‚¹ãƒ†ãƒƒãƒ—ã¯ãªã‚“ã¨ã‹è§£ã‘ãŸãªã€‚ã‚ˆã—ã€æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã®ã‚­ãƒƒãƒˆã‚’ãã‚Œã€",
      "æ–°ã€Œã‚ã‹ã‚Šã¾ã—ãŸï¼æº–å‚™ã™ã‚‹ã®ã§ãŠå¾…ã¡ãã ã•ã„ï¼ã€",
      "ã‚ï¼ˆã„ã‚„ã ã‹ã‚‰ã€è§£ã„ã¦ã„ã‚‹é–“ã«æº–å‚™ã—ã¨ã‘ã‚ˆã€œã€‚æ™‚é–“ãŒãªã„ã£ã¦ã„ã†ã®ã«â€¦â€¦ï¼‰",
      "æ–°ã€Œã‚ãããã‚ã‚ã‚ï¼ã€",
      "ã‚ã€Œã¾ãŸï¼Ÿï¼å¤§ä¸ˆå¤«ã‹ï¼Ÿã€",
      "æ–°ã€Œå¤§ä¸ˆå¤«ã§ã™ï¼ãƒãƒ¼ãƒ•ã¯ãã“ã«ã„ã¦ãã ã•ã„ï¼ã€",
      "æ•°åˆ†å¾Œã€æ–°å…¥ç¤¾å“¡ãŒæ¬¡ã®ã‚­ãƒƒãƒˆã‚’æŒã£ã¦ãã¾ã—ãŸã€‚",
      "æ–°ã€ŒãŠå¾…ã›ã—ã¾ã—ãŸï¼ã“ã¡ã‚‰ãŒæ¬¡ã®ã‚­ãƒƒãƒˆâ€¦â€¦ãªã‚“ã§ã™ãŒâ€¦â€¦ã€",
      "ã‚ã€Œä»Šåº¦ã¯ãªã‚“ã â€¦â€¦ã€",
      "æ–°ã€Œé’è‰²ã®ã‚¤ãƒ³ã‚¯ã®è£œå……ã¯ã—ãŸã‚“ã§ã™ãŒã€èª¤ã£ã¦ç™½é»’å°åˆ·ã‚’ã—ã¦ã—ã¾ã„ã¾ã—ãŸâ€¦â€¦ã€‚\nãƒãƒ¼ãƒ•ã«ã¯ç”³ã—è¨³ãªã„ã‚“ã§ã™ãŒã€ãƒ¢ãƒŽã‚¯ãƒ­çŠ¶æ…‹ã«ãªã£ã¦ã—ã¾ã£ãŸè¬ŽãŒå…ƒã¯ã©ã‚“ãªè¬Žã ã£ãŸã®ã‹ã‚’æƒ³åƒã—ã¦è§£ã„ã¦ãã‚Œã¾ã›ã‚“ã‹â€¦â€¦ï¼Ÿãƒãƒ¼ãƒ•ã®è¬Žè§£ãåŠ›ãªã‚‰ãã£ã¨å¤§ä¸ˆå¤«ã§ã™ï¼ã€",
      "ã‚ã€Œã¾ã€ã¾ãã—ã‹ãŸãªã„ã‹â€¦â€¦æ¬¡ã¯å°åˆ·ãƒŸã‚¹ã™ã‚‹ãªã‚ˆã€",
    ],
    instructionLabel: "3rdã‚¹ãƒ†ãƒƒãƒ—",
    instructionLines: [
      "ï¼“ã®å°ç­’ã®ä¸­ã«ã‚ã‚‹3rdã‚¹ãƒ†ãƒƒãƒ—ã®ã‚­ãƒƒãƒˆã‚’å–ã‚Šå‡ºãã†ã€‚",
      "è¬Žã‚’è§£ãæ˜Žã‹ã—ã¦ã€webã‚µã‚¤ãƒˆã«å…¥åŠ›ã™ã‚‹3rdã‚¹ãƒ†ãƒƒãƒ—ã®ç­”ãˆã‚’é€ä¿¡ã—ã‚ˆã†ã€‚",
      "ï¼œã€€ã²ã‚‰ãŒãªã§å…¥åŠ›ã€€ï¼ž",
    ],
    placeholder: "ã“ãŸãˆã‚’å…¥åŠ›",
  },
  {
    key: "last",
    answer: "ã‚„ã‚ŠãŒã„",
    storyTitle: "STORY LAST",
    story: [
      "ã‚ã€Œ3rdã‚¹ãƒ†ãƒƒãƒ—ã‚‚ãªã‚“ã¨ã‹è§£ã‘ãŸãªã€‚ã‚ˆã—ã€æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã®ã‚­ãƒƒãƒˆã‚’ãã‚Œã€",
      "æ–°ã€Œã¯ã„ï¼æœ€å¾Œã®ã‚¹ãƒ†ãƒƒãƒ—ã¯æº–å‚™æ¸ˆã¿ã§ã™ï¼ã€",
      "ã‚ï¼ˆãŠã€æœ€å¾Œã¯æº–å‚™ã—ã¦ã„ã‚‹ã®ã‹ï¼‰",
      "æ–°ã€ŒLASTã‚¹ãƒ†ãƒƒãƒ—ã¯ã“ã®ç´™1æžšã ã‘ã§ã™ï¼å°åˆ·ã¯æ­£ã—ãã§ããŸã—ã€è£æ–­ã¯ä¸è¦ã ã£ãŸã®ã§å°åˆ·ã—ãŸã¾ã¾ã®çŠ¶æ…‹ã§æ¸¡ã—ã¾ã™ã­ã€",
      "ã‚ã€Œäº†è§£ã€œã€",
    ],
    instructionLabel: "LASTã‚¹ãƒ†ãƒƒãƒ—",
    instructionLines: [
      "LASTã®å°ç­’ã®ä¸­ã«ã‚ã‚‹lastã‚¹ãƒ†ãƒƒãƒ—ã®ã‚­ãƒƒãƒˆã‚’å–ã‚Šå‡ºãã†ã€‚",
      "è¬Žã‚’è§£ãæ˜Žã‹ã—ã¦ã€webã‚µã‚¤ãƒˆã«å…¥åŠ›ã™ã‚‹lastã‚¹ãƒ†ãƒƒãƒ—ã®ç­”ãˆã‚’é€ä¿¡ã—ã‚ˆã†ã€‚",
      "ï¼œã€€ã²ã‚‰ãŒãªã§å…¥åŠ›ã€€ï¼ž",
    ],
    placeholder: "ã“ãŸãˆã‚’å…¥åŠ›",
  },
  {
    key: "epilogue",
    answer: "ãˆãã™ã¦ã‚“ã©",
    storyTitle: "ã‚¨ãƒ”ãƒ­ãƒ¼ã‚°",
    story: [
      "ã‚ã€Œã“ã‚Œã€è£æ–­ã®ã‚„ã‚Šæ–¹é–“é•ãˆã¦ãªã„ã‹ï¼Ÿ\nã€€ã€€æœ¬æ¥ã¯ã€å¯¾è§’ç·šã«æ²¿ã£ã¦ï¼”ç­‰åˆ†ã«ã™ã‚‹ã®ãŒæ­£ã—ã„æ°—ãŒã™ã‚‹ãŒã€",
      "æ–°ã€Œãˆâ€¦â€¦ã‚ï¼æœ¬å½“ã ã€‚ã™ã¿ã¾ã›ã‚“ï¼åƒ•ã®ãƒŸã‚¹ã§ã™â€¦â€¦ã¡ã‚ƒã‚“ã¨è§£ã‘ã¾ã—ãŸã‹â€¦â€¦ï¼Ÿã€",
      "ã‚ã€Œã¾ã‚ã€å¶ç„¶ã«ã‚‚è¬ŽãŒæˆç«‹ã—ã¦ãŸã‹ã‚‰ã„ã„ã‚‚ã®ã®ã€ã“ã‚“ãªãƒŸã‚¹ã‚ã‚Šãˆãªã„ãžï¼Ÿæ®µå–ã‚Šã‚‚æ‚ªã„ã—ã€å…ˆè¼©ã‹ã‚‰è¨€ã‚ã‚ŒãŸã“ã¨ã‚’ãã®ã¾ã¾å‡ºæ¥ãªã„ã¨â€¦â€¦ã€",
      "æ–°ã€Œâ€¦â€¦ãµãµãµã€",
      "ã‚ã€ŒãŠã„ã€ä½•ãŒãŠã‹ã—ã„ã€",
      "æ–°ã€Œã‚ã¯ã¯ã¯ï¼ã‚‚ã†æˆ‘æ…¢ã§ããªã„ã§ã™ç¬‘ã€€å…ˆè¼©ã€å‡ºã¦ãã¦ãã ã•ã„ã€",
      "æ–°å…¥ç¤¾å“¡ã®å‘¼ã³ã‹ã‘ã«åˆã‚ã›ã¦ã€ä¼šè­°å®¤ã®ãƒ‰ã‚¢ãŒé–‹ã„ãŸ",
      "å…ˆè¼©ã€ŒãŠç–²ã‚Œæ§˜ã§ã™ã€ãƒãƒ¼ãƒ•ã€‚ã™ã¿ã¾ã›ã‚“ï¼ã“ã‚Œå…¨éƒ¨ãƒ‰ãƒƒã‚­ãƒªã§ã—ãŸã€",
      "ã‚ã€Œã‚ã‚Œï¼ŸãŠå‰ã€ä½“èª¿å´©ã—ãŸã£ã¦â€¦â€¦ã¨ã„ã†ã‹ãƒ‰ãƒƒã‚­ãƒªã£ã¦ã©ã†ã„ã†ã“ã¨ã ã‚ˆã€",
      "å…ˆã€Œä»Šå›žã®è¬Žè§£ãã¯ã€è¬Žè§£ãã‚­ãƒƒãƒˆãŒå°åˆ·ãƒŸã‚¹ã‚„è£æ–­ãƒŸã‚¹ã•ã‚Œã¦ã„ã‚‹ä¸­ãªã‚“ã¨ã‹ã—ã¦ç­”ãˆã‚’è§£ãæ˜Žã‹ã™ã¨ã„ã†ã‚³ãƒ³ã‚»ãƒ—ãƒˆã ã£ãŸã‚“ã§ã™ã‚ˆã€‚\nãªã®ã§ã€ã“ã®ã‚³ãƒ³ã‚»ãƒ—ãƒˆã‚’ã¯ã˜ã‚ã«è©±ã—ã¦ã—ã¾ã†ã¨ãƒã‚¿ãƒãƒ¬ã«ãªã£ã¦ã—ã¾ã†ã®ã§ã€ä»Šå›žã®ãƒ†ã‚¹ãƒˆãƒ—ãƒ¬ã‚¤ã§ã¯ã“ã®ã‚ˆã†ãªæ–¹å¼ã‚’ã¨ã‚‰ã›ã¦ã„ãŸã ãã¾ã—ãŸã€‚é¨™ã™ã‚ˆã†ãªå½¢ã«ãªã£ã¦ã—ã¾ã„ã™ã¿ã¾ã›ã‚“ï¼ã€",
      "ã‚ã€Œãªã‚‹ã»ã©ãªã€‚â€¦â€¦ã‚ã€œã€‚ã ã‹ã‚‰æ–°äººãã‚“ã¯æ¬¡ã®æº–å‚™ã‚’ã›ãšã«ãšã£ã¨ç§ã®è¿‘ãã«ã„ãŸã‚“ã ãªã€‚ç§ãŒã©ã®ã‚ˆã†ã«è¬Žã‚’è§£ãã®ã‹ã€å›ã«ä»£ã‚ã£ã¦ãƒã‚§ãƒƒã‚¯ã™ã‚‹ãŸã‚ã«ã€",
      "æ–°ã€Œãã†ã„ã†ã“ã¨ã§ã™ï¼æ®µå–ã‚ŠãŒæ‚ªãè¦‹ãˆã¦ã—ã¾ã£ãŸã‚‰ç”³ã—è¨³ãªã„ã§ã™ï¼ã€",
      "ã‚ã€Œã„ã‚„ã„ã‚„ã€ã„ã„æ¼”æŠ€ã ã£ãŸã‚ˆã€",
      "å…ˆã€Œã¨ã„ã†ã“ã¨ã§ã€ä»Šå›žã®è¬Žè§£ãã¯ã©ã†ã§ã—ãŸã‹ï¼Ÿã€",
      "ã‚ã€Œãªã‹ãªã‹ã„ã„è¬Žè§£ãã ã£ãŸã‚ˆã€‚ã“ã†ã„ã†ãƒ†ãƒ³ã‚«ã‚¤ã‚‚æ‚ªããªã„ã­ã€",
      "æ–°ã€ŒãŠã€åï¼ˆãƒ†ãƒ³ï¼‰Xï¼ˆã‚«ã‚¤ï¼‰ã£ã¦ã“ã¨ã§ã™ã­ã€ã†ã¾ã„ã£ã™ã­ãƒãƒ¼ãƒ•ï¼ã€",
      "ã‚ã€Œã„ã‚„ã„ã‚„ã€ãã‚Œã»ã©ã§ã‚‚ã€œã€",
      "å…ˆã€Œâ€¦â€¦ã¾ããƒ€ã‚¸ãƒ£ãƒ¬ã¯ãã“ã¾ã§ã«ã—ã¦ã€ã“ã‚Œã¯è²©å£²æ±ºå®šã§ã„ã„ã§ã™ã‹ã­ï¼Ÿã€",
      "ã‚ã€Œã‚ã€ã‚ãã€œã‚‚ã¡ã‚ã‚“ï¼è²©å£²æ±ºå®šã ã€",
      "æ–°ã€Œã‚„ã‚Šã¾ã—ãŸã­ã€å…ˆè¼©ï¼ãªã‚‰æ—©é€Ÿã‚¿ã‚¤ãƒˆãƒ«ã‚’æ±ºã‚ãªã„ã¨ã€‚ã©ã‚“ãªã‚¿ã‚¤ãƒˆãƒ«ã«ã—ã¾ã™ã‹ï¼Ÿã€",
      "ã‚ã€Œãã‚Œã¯ã€ã‚ã‚Œã—ã‹ãªã„ã ã‚ã€",
      "å…ˆã€Œã§ã™ã­ã€",
      "æ–°ã€Œãˆï¼Ÿã©ã‚“ãªã‚¿ã‚¤ãƒˆãƒ«ã§ã™ã‹ï¼Ÿã€",
      "ã‚å…ˆã€Œã€Žãƒ†ã‚¹ãƒˆãƒ—ãƒ¬ã‚¤ãŠé¡˜ã„ã—ã¾ã™ã€ã€",
      "",
      "ã‚¯ãƒªã‚¢ãŠã‚ã§ã¨ã†ã€œ",
      "ã‚ã¨ã€å…ˆè¼©ãŒãƒ†ã‚¹ãƒˆãƒ—ãƒ¬ã‚¤ã®åˆé–“ã«ã‚¨ã‚¯ã‚¹ãƒˆãƒ©ã‚¹ãƒ†ãƒƒãƒ—ã‚‚ä½œã£ãŸã‚ˆã†ãªã®ã§ã€",
      "æ™‚é–“ã®ã‚ã‚‹æ–¹ã¯è§£ã„ã¦ã¿ã¦ã­ã€œ",
    ],
    instructionLabel: "EXTRA",
    instructionLines: [
      "LASTã®å°ç­’ã®ä¸­ã«ã‚ã‚‹lastã‚¹ãƒ†ãƒƒãƒ—ã®ã‚­ãƒƒãƒˆã‚’å–ã‚Šå‡ºãã†ã€‚",
      "è¬Žã‚’è§£ãæ˜Žã‹ã—ã¦ã€webã‚µã‚¤ãƒˆã«å…¥åŠ›ã™ã‚‹lastã‚¹ãƒ†ãƒƒãƒ—ã®ç­”ãˆã‚’é€ä¿¡ã—ã‚ˆã†ã€‚",
      "ï¼œã€€ã²ã‚‰ãŒãªã§å…¥åŠ›ã€€ï¼ž",
    ],
    placeholder: "ãˆãã™ã¦ã‚“ã©",
  },
];

const state = {
  progress: 0, // index into STEPS
};

const flowEl = document.getElementById("flow");

function el(tag, className, children) {
  const e = document.createElement(tag);
  if (className) e.className = className;
  if (Array.isArray(children)) children.forEach((c) => e.append(c));
  else if (children != null) e.append(children);
  return e;
}

function para(text, cls) {
  // keep explicit newlines from story
  const lines = String(text).split(/\n/);
  const frag = document.createDocumentFragment();
  const blockCls = cls || blockClass(text);
  lines.forEach((ln) => {
    const p = document.createElement("p");
    const sp = blockCls || speakerClass(ln);
    if (sp) p.className = sp;
    p.textContent = ln;
    frag.append(p);
  });
  return frag;
}

function blockClass(text) {
  // Color quoted chat blocks (ã€Žâ€¦ã€) in green
  if (text.includes("ã€Ž")) return "speaker-senior";
  return "";
}

function speakerClass(line) {
  // Detect dialog prefixes and map to speaker classes
  // Variants: ã‚ã€Œ â€¦ ã€ or ã‚ãªãŸã€Œ â€¦ ã€
  //           æ–°ã€Œ â€¦ ã€ or æ–°å…¥ç¤¾å“¡ã€Œ â€¦ ã€
  //           å…ˆã€Œ â€¦ ã€ or å…ˆè¼©ã€Œ â€¦ ã€
  const starts = (p) => line.startsWith(p);
  if (starts("ã‚ã€Œ") || starts("ã‚ãªãŸã€Œ")) return "speaker-you";
  if (starts("æ–°ã€Œ") || starts("æ–°å…¥ç¤¾å“¡ã€Œ")) return "speaker-junior";
  if (starts("å…ˆã€Œ") || starts("å…ˆè¼©ã€Œ")) return "speaker-senior";
  return "";
}

function renderStep(idx) {
  const s = STEPS[idx];
  const section = el("section", "step fade-in");
  section.append(el("div", "node"));

  const block = el("div", "block");

  const story = el("div", "story");
  story.append(el("h2", null, s.storyTitle));
  s.story.forEach((t) => story.append(para(t)));

  const instruction = el("div", "instruction");
  instruction.append(el("div", "label", s.instructionLabel));
  const instLines = el("div", "lines");
  s.instructionLines.forEach((t) => instLines.append(para(t)));
  instruction.append(instLines);

  const form = el("form", "form");
  const inputWrap = el("div", "input");
  const input = document.createElement("input");
  input.type = "text";
  input.autocomplete = "off";
  input.inputMode = "kana";
  input.placeholder = s.placeholder || "ã“ãŸãˆã‚’å…¥åŠ›";
  inputWrap.append(input);

  const btn = el("button", "btn", "é€ä¿¡");
  btn.type = "submit";

  form.append(inputWrap, btn);
  const feedback = el("div", "feedback");

  form.addEventListener("submit", (e) => {
    e.preventDefault();
    const raw = input.value;
    const normalized = normalizeJa(raw);
    const target = normalizeJa(s.answer);
    if (!raw.trim()) return shake(input);

    if (normalized === target) {
      feedback.className = "feedback ok";
      feedback.textContent = "æ­£è§£";
      input.disabled = true;
      btn.disabled = true;
      // advance to next step if exists
      if (idx + 1 < STEPS.length) {
        state.progress = idx + 1;
        // defer append for smoother UX
        setTimeout(() => {
          const nextEl = renderStep(idx + 1);
          nextEl.scrollIntoView({ behavior: "smooth", block: "start" });
        }, 250);
      } else {
        // All clear
        setTimeout(() => showAllClear(section), 280);
      }
    } else {
      feedback.className = "feedback err";
      feedback.textContent = "ã¡ãŒã†ã‚ˆã†ã ";
      shake(input);
    }
  });

  block.append(story, instruction, form, feedback);
  section.append(block);
  flowEl.append(section);
  // Focus input when rendered
  setTimeout(() => input.focus(), 0);
  return section;
}

function showAllClear(parentSection) {
  const clear = el("div", "allclear fade-in");
  clear.append(el("div", "big", "ALL CLEAR"));
  clear.append(el("div", "small", "ãŠã¤ã‹ã‚Œã•ã¾ã§ã—ãŸï¼"));
  parentSection.append(clear);
}

function shake(elm) {
  elm.classList.remove("shake");
  // force reflow
  void elm.offsetWidth;
  elm.classList.add("shake");
}

// Normalize: trim, NFKC, remove spaces, convert Katakana to Hiragana
function normalizeJa(str) {
  if (!str) return "";
  let s = str.normalize("NFKC").trim().toLowerCase();
  // remove spaces (half/full)
  s = s.replace(/[\s\u3000]/g, "");
  // convert Katakana to Hiragana, keep prolonged sound mark ãƒ¼ as-is
  let out = "";
  for (const ch of s) {
    const code = ch.codePointAt(0);
    if (code >= 0x30a1 && code <= 0x30f6) {
      out += String.fromCodePoint(code - 0x60);
    } else {
      out += ch;
    }
  }
  return out;
}

// boot
renderStep(0);
